# 1. Базовый образ с Python
#    slim — облегчённая версия без лишних пакетов ОС.
FROM python:3.12-slim

# 2. Настройки окружения:
#    - не писать .pyc файлы
#    - вывод не буферизуется (логи сразу в stdout/stderr, удобно для Docker)
ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1

# 3. Рабочая директория внутри контейнера.
#    Все последующие команды (COPY, RUN, CMD) будут выполняться относительно /app.
WORKDIR /app

# 4. Сначала копируем только requirements.txt.
#    Это позволяет Docker кэшировать слой с установкой зависимостей:
#    если зависимости не менялись, pip install повторно не выполнится.
COPY requirements.txt .

# 5. Устанавливаем зависимости.
#    --no-cache-dir уменьшает размер образа (pip не хранит кеш).
RUN pip install --no-cache-dir -r requirements.txt

# 6. Теперь копируем остальной код (app.py и всё, что рядом).
#    Делается после установки зависимостей, чтобы не ломать кэш при частых изменениях кода.
COPY . .

# 7. (Не обязательно, но полезно) объявляем порт,
#    который слушает приложение внутри контейнера.
EXPOSE 8000

# 8. Команда запуска.
#    В проде лучше не использовать встроенный сервер Flask,
#    поэтому запускаем через gunicorn, предполагая, что он есть в requirements.txt.
#    Формат: <модуль>:<переменная app>
CMD ["gunicorn", "-b", "0.0.0.0:8000", "app:app"]
